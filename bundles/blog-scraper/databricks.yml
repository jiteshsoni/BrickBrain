bundle:
  name: blog-scraper

workspace:
  root_path: /Shared/brickbrain/blog-scraper

resources:
  jobs:
    blog_scraper_daily_job:
      name: "Blog Scraper - Daily Job"
      tasks:
        - task_key: "scrape_blogs"
          new_cluster:
            spark_version: "13.3.x-scala2.12"
            node_type_id: "i3.xlarge"
            num_workers: 1
            spark_conf:
              "spark.databricks.delta.preview.enabled": "true"
              "spark.databricks.cluster.profile": "singleNode"
          git_source:
            git_url: "https://github.com/jiteshsoni/BrickBrain.git"
            git_branch: "scrape_blogs"
            git_provider: "gitHub"
          notebook_task:
            notebook_path: "bundles/blog-scraper/notebooks/blog_scraper_pipeline"
            base_parameters:
              websites: "https://www.databricksters.com/,https://www.canadiandataguy.com/"
              delta_table_name: "main.default.blog_content"
          libraries:
            - pypi:
                package: "requests>=2.31.0"
            - pypi:
                package: "beautifulsoup4>=4.12.0"
            - pypi:
                package: "html2text>=2020.1.16"
            - pypi:
                package: "lxml>=4.9.0"
            - pypi:
                package: "urllib3>=2.0.0"
            - pypi:
                package: "databricks-connect>=15.0.0"
          timeout_seconds: 3600
          max_retries: 2
          retry_on_timeout: true
      schedule:
        quartz_cron_expression: "0 0 6 * * ?"  # Daily at 6 AM UTC
        timezone_id: "UTC"
        pause_status: "UNPAUSED"
      max_concurrent_runs: 1
      timeout_seconds: 3600
      tags:
        purpose: "blog-scraping"
        environment: "production"
        team: "data-engineering"

variables:
  websites:
    description: "Comma-separated list of websites to scrape"
    default: "https://www.databricksters.com/,https://www.canadiandataguy.com/"
  delta_table_name:
    description: "Name of the Delta table to store blog content"
    default: "main.default.blog_content"
  schedule_cron:
    description: "Cron expression for job scheduling"
    default: "0 0 6 * * ?"